#### Postgres
##### Основы SQL:

**В чем разница между WHERE и HAVING? Когда стоит использовать каждое из них?**

- Where используется до группировки
- Having используется после группировки чтобы уточнить группируемые значения

**Как работает GROUP BY? Какие ограничения есть при использовании GROUP BY с SELECT?**

- В Select нужно добавлять то значение, по которому проводится группировка

**Как можно оптимизировать запрос с ORDER BY на больших таблицах?**

- Использовать индексы на колонку, по которой проходит OrderBy или использовать составные индексы
- Проверяй узкие места при помощи EXPLAIN ANALYZE

##### Агрегатные функции:

**Какие агрегатные функции ты знаешь? Приведи пример использования.**

- COUNT, SUM, AVG, MIN, MAX

**Как работает DISTINCT внутри агрегатных функций? Например, COUNT(DISTINCT column).**

- Выбирает уникальные значения при агрегатных функциях

##### Join'ы:

**Какие типы JOIN ты знаешь? В чем разница между INNER JOIN, LEFT JOIN, RIGHT JOIN и FULL JOIN?**

- INNER, LEFT, RIGHT, FULL
- INNER берёт данные из соседней таблицы, когда внешнему ключу соответствует ключ смежной таблицы
- LEFT делает INNER, а потом добавляет все данные из смежной таблицы, которые не совпали в "ЛЕВОЙ"
- RIGHT делает тоже самое, но с "ПРАВОЙ".
- FULL берёт все данные, даже если нет совпадений в обеих таблицах.

**Какой JOIN ты бы использовал, если нужно выбрать все записи из одной таблицы, даже если нет совпадений в другой?**

- LEFT JOIN

**Как избежать CARTESIAN JOIN и чем он опасен?**

- Возникает когда нет условия ON в JOINе

##### Транзакции:

**Что такое транзакции? Какие уровни изоляции ты знаешь?**

- Инкапсулированный набор SQL запросов, которые рассматриваются по принципу "ВСЁ ИЛИ НИЧЕГО".
- Read Uncommited (незафиксированные изменения), Read Commited (зафиксированные изменения), Repeatable Read (работает со снимком данных), Serializable (выполняет строгую последовательность транзакций)

**Как ты бы обработал ситуацию, когда две транзакции пытаются изменить одни и те же данные?**

- При помощи локов. Если две транзакции пытаются изменить одно и то же поле, то на него накладывается Lock и ждёт пока первая транзакция не будет законечна коммитом или не откатится.
- Или оптимистичных локов. Транзакция проверяет, было ли изменено поле с момента последнего чтения.
- Для короктовременных конфликтов можно использовать повтор транзакции (Retry)

```SQL
BEGIN
LOCK TABLE IN <...> MODE;
...
COMMIT;
```

Оптимистичный лок:
- Создание column 'version', чтобы проверять изменения.

**Что такое deadlock и как его избежать?**

- Это когда два или более транзакции блокируют ресурсы друг-друга и не могут выполнить операцию
- Избежать можно путём упорядочивания транзакций, таймаутов, коротких транзакций, выбор правильного уровня изоляции

##### Миграции:

**Как ты работаешь с миграциями в Symfony? Какие инструменты используешь (например, Doctrine Migrations)?**

- Doctrine Migrations
- Для создания миграций используется doctrine:migrations:generate или проще doctrine:migrations:diff - он сам генерирует миграцию
- Для накатывания миграций использую doctrine:migrations:migrate
- Для отката doctrinde:migrations:migrate --down="previous" либо --to="X" - X это версия транзакции.

**Как ты тестируешь миграции перед их применением на production?**

- Проверяю их на тестовой БД, если не возникает конфликтов - можно выкатывать
##### Constraints:

**Какие типы constraints ты знаешь? Как они помогают поддерживать целостность данных?**

- Null/not null (нулевое, не нулевое), unique (уникальное значение), primary key (основной уникальный ключ), foreign key (ключ для связки с другими таблицами), check (проверка значения на условие)

**Как ты бы добавил уникальный constraint на несколько колонок?**

```SQL
ALTER TABLE
ADD CONSTRAINT unique_name_email UNIQUE (email, email);
```

**Что такое foreign key и как он связан с JOIN?**

- Отвечает за связь вхожих в таблицу связей, также часто используется в качестве уточнения ON

#### Хорошее знание языка/платформы (PHP, Symfony)
##### PHP:

**В чем разница между == и === ? Почему важно использовать === ?**

- Строгое и нестрогое равенство. В случае с === строго проверяет тип сравнививаемых переменных.
- Из-за строгой типизации и исключения ошибок рекомендуется использовать строгое сравнение.

**Как работает автозагрузка классов в PHP? Что такое PSR-4?**

- Подгружает классы, когда они используют в коде без использования include или require.
- PSR-4 - стандарт автоподгрузки файлов, когда namespace соответствует расположению каталогов, а имя класса соответствует имени файла

**Что такое генераторы (generators) в PHP и когда их стоит использовать?**

- Это функции для итерации данных, которые не завершаются, но отдают данные. Используют вместо return yield. При следующем запросе она остаётся на том же месте где остановилась.
- При обработки больших объёмов памяти без помещения их в память
- При создании итератора для сложных структур данных
- Для ленивой загрузки данных

**Как ты бы реализовал кеширование в PHP без использования сторонних библиотек?**

- Можно использовать файловую систему или shared memory для кеширования.

##### Symfony:

**Как работает Dependency Injection в Symfony? Какие преимущества он дает?**

- DI это передача необходимых сервисов происходит путём конструктора.
- Это шаблон проектирования при котором необходимые сервисы передаются извне, а не создаются внутри класса.
- Преимущества - снижает связанность (класс не отвечает за создание объекта), облегчает тестирование, гибкость.

**Что такое сервисы в Symfony? Как ты регистрируешь свои сервисы?**

- Это класс, который выполняет определённую задачу в приложении. Обычно отвечает за какой-то аспект бизнес-логики приложения.
- Сервисы регистрируются в контейнере сервисов при помощи конфигов (YAML, XML, PHP).

**Как ты работаешь с событиями (EventDispatcher) в Symfony? Приведи пример использования.**

- Полезная штука, которая диспатчит событие при определённом условии. Никак не работаю.

**Как ты настраиваешь маршруты (routing) в Symfony? Что такое аннотации и чем они удобны?**

- Роуты настраиваются при помощи аннотации Route, где указывается путь, имя метода, метод, дефолтные настройки, констрейнты. Регистрируем роут в конфиге routes, если потребуется.
- Полезны, потому что позволяют настройки роута держать рядом с кодом, заполнять методанные

**Как ты бы реализовал аутентификацию и авторизацию в Symfony?**

Для создания аутентификации необходимо настроить:
- Firewall - определяет, какие роуты требуют аутентификации.
- UserProvider - как получать пользователя из БД.
- Аутентификатор - обрабатывает процесс аутентификации (например через api-ключ или jwt токен)
Для создания авторизации необходимо настроить:
- Систему ролей - какие роли куда могут попасть
- ACL - проверка доступа на оснвое объекта
- Вотерсы для определения доступа к определённым совйствам

Или можно сделать это через:
- Firewall
- UserResolver
- Хэширование пароля
- Использование User в качестве аргумента в контроллере

##### Оптимизация:

**Как ты оптимизируешь производительность Symfony-приложения?**

- Opcache
- Кэширование (http, doctrine)
- Оптимизация запросов

**Что такое кеширование в Symfony? Какие типы кешей ты знаешь?**

- http - ответы на запросы
- doctrine - результаты запроса из бд
- query - данные по запросу
- result - результат выборки сущностей
- twig - кеширование шаблонов
- data cache - кеширование произвольных данных (например через redis, memcache, filesystem)

**Как ты бы отладил медленный запрос в Symfony?**

- Через Symfony Profiler или xdebug посмотрел бы как быстро выполняется запрос 
- Указал бы EXPLAIN ANALYZE если необходимо
- Database Profiler

#### SRE (поверхностные знания)
##### Docker:

**Что такое Docker и зачем он нужен? Как ты используешь его в своих проектах?**

- Программа для создания контейнеров для лёгкой работы с кодом/проектом на других машинах в подготовленном в контейнере окружении.

**Как ты бы создал Docker-образ для Symfony-приложения?**

- Путём создания Dockerfile:
```dockerfile
FROM php:8.3-fpm-alpine3.19

WORKDIR /var/www/html

COPY --from=mlocati/php-extenstion-installer /usr/bin/install-php-extensions /usr/bin/
RUN install-php-extensions \
	intl \
	opcache \
	pdo_sql \
	...
> /dev/null
RUN rm /usr/bin/install-php-extensions

COPY --from=composer var/www/html/vednor /var/www/html/vendor/
COPY ./app /var/www/html

RUN cp $PHP_INI_DIR/php.ini-production $PHP_INI_DIR/php.ini
COPY .docker/php/fpm/php.ini $PHP_INI_DIR/conf.d/php-app.ini
COPY .docker/php/fpm/php-fpm.conf $PHP_INI_DIR/../php-fpm.d/zzz-app.conf

ARG APP_VERSION
ARG API_VERSION

ENV APP_VERSION=$APPVERSION
ENV API_VERSION=$APIVERSION

USER www-data
```

**В чем разница между COPY и ADD в Dockerfile?**

- COPY Копирует файлы
- ADD Аналогично, но также может разворачивать tar архивы и брать файлы из URL

**Как ты управляешь несколькими контейнерами (например, база данных и приложение)?**

- Использую Docker-compose файл, который объединяет в себе настройки и пути до Dockerfile с настроайками. 

##### GitHub CI:

**Как ты настраиваешь CI/CD для Symfony-проекта? Какие этапы обычно включаешь?**

- Через git actions, где настраивается workflow:
```yaml
name: CI\CD

on:
	push:
		branches: [main]
	pull_request:
		branches: [main]

jobs:
	build:
		runs-on: ubuntu-latest

		steps:
		- uses: actions/checkout@v2

		- name: setup PHP
		  uses: shivamattur/setup-php@v2
		  with: php-version 8.3

		-name: Install Composer Dependancies
		 run: composer install --no-intraction --no-progess --no-suggest
		 
		 -name: Run tests
		 run: bin/phpunit

```

**Как ты бы автоматизировал запуск тестов при каждом пулл-реквесте?**

- Используя триггер pull_request

**Что такое artifacts в GitHub CI и зачем они нужны?**

- Это файлы, которые создаются в процессе работы workflow и могут быть сохранены и использованы в других workflow или вручную

#### Тесты
##### Как писать:

**Какие типы тестов ты знаешь? В чем их отличия?**

- Unit (отдельные аспекты кода)
- Functional (общие аспекты - контроллеры, сервисы)
- Integrational (проверяют связи со внешними сервисами - бд, сторонними api)
- End-to-End (E2E) (Имитируют флоу пользователя, тестируем систему целиком)

**Как ты пишешь unit-тесты для Symfony-сервисов? Какие библиотеки используешь?**

- Для тестирования сервисов используется PHPUnit
- Пишется тест на основе данных, собранных через mock, generator или builder.
- Проверяется через self::assert... что нужные данные были получены, изменены, удалены.
- Используется: ClockMock...

**Как ты тестируешь контроллеры в Symfony?**

- Для тестирования контроллеров используется PHPUnit
- Пишется тест на основе данных, собранных через builder
- Имитируется запрос через RequestBuilder, который обращается к KernelBrowser
- Проверяется что статус соответствует self::assertResponseStatusCodeSame
- Проверяется что количество айтемов в листинге соответствует self::assertCountOfItemsInResponse
- Если нужно вытащить данные и посмотреть изменения, то используется self::getFieldFromHttpResponse
##### Что тестировать:

**Какие части приложения ты считаешь наиболее важными для тестирования? Почему?**

- Все контроллеры, все сервисы, денормалайзеры

**Как ты тестируешь взаимодействие с базой данных? Используешь ли ты фикстуры?**

- Никак 0_о но видимо надо.

**Как ты тестируешь edge cases (граничные случаи)?**

- Пустые значения, null, неверные типы данных
- Предельные значения (min, max)
- Ошибки сети, недоступность сервисов
##### А нужно ли?

**Всегда ли нужно писать тесты? Когда тесты могут быть излишними?**

- Вообще всегда, но если код выполняет тривиальные операции, то тесты могут не потребоваться
- Не везде требуется писать end-to-end тесты

**Как ты определяешь, какой код нужно покрыть тестами, а какой нет?**

- По наитию