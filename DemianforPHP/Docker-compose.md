[Docker](#Docker)
[Команды](#Команды)
### Docker

**Контейнер** - завёрнутое приложение со всеми прикладными образами.

**Образ** - программные компоненты, которые используются при работе пиложения (postgress, php-fpm, redis, ...).

#### Команды:
- Стартует контейнер:
```
docker start <name/id>
```

- Ставит контейнер на паузу:
```
docker pause <name/id>
```

- Останавливает контейнер:
```
docker stop <name/id>
```

- Выводит информацию о существующих контейнерах:
```
docker info
```

- Выводит помощь:
```
docker help
```

Выводит справку о команде:
```
docker <команда> -help
```

----
#### Сбор Dockerfile
В проекте, в нужном месте необходимо создать Dockerfile для описания образа.
Команды внутри:
```Dockerfile
FROM php:8.3-fpm-alpine3.19 //какой образ использовать

COPY ./app/src ./src //из какой папки брать, в какую папку в образе всё записывать

WORKDIR var/www/html //рабочая директория в образе

RUN //compiler, который выполняется 1 раз при создании образа

CMD // выполняется каждый раз при запуске контейнера
```

В RUN кроме основного выполняющего файла можно указать также установку необходимых пакетов.
Например:
```Dockerfile
RUN install-php-extensions \  
    intl \  
    opcache \  
    pdo_pgsql \  
    uuid \  
    mongodb \  
    gd \  
    uopz \  
 > /dev/null  
RUN rm /usr/bin/install-php-extensions
```

`rm` = remove;

----

### Docker-Compose

Инструмент, который позволяет определять и запускать многоконтейнерные приложения. 

В отличии от docker вместо запуска каждого контейнера вручную, запускает их всех одним скопом.
Информацию о скорпе контейнеров необходимо указать в docker-compose.yml и запускается одной командой: 
```
docker-compose up -d
```

Управляет зависимостями, которые также указываются внутри файла настройки и запускает контейнеры в нужном поряде.

Остановить контейнеры можно путём:
```
docker-compose down
```

Собрать образы:
```
docker-compose build
```

Посмотреть лог:
```
docker-compose log
```

----
Порядок действий:
I. Описать Dockerfile для каждого сервиса (контейнера). В файла указать:
- Базовый образ (ubuntu, python:3.9, node:16)
- Команды для установки необходимых программ и библиотек
- Команды для копирования файлов в контейнер
- Команду `CMD` или `ENTRYPOINT`, которая указывает что должно выполняться в контейнере после запуска.

II. Описание docker-compose.yml. Указать все сервисы приложения, используя Dockerfile. Для каждого сервиса указать:
- Имя сервиса
- Путь до файла Dockerfile
- Порты, которые нужно открыть для сервиса извне
- Переменные окружения
- Volumes - позволяют синхронизировать файлы между хостом и контейнером
- Зависимости между сервисами

III. Собрать образы путём docker-compose build - читает все Dockerfile, указанные в docker-compose.yml.

IV. Запустить контейнер `docker-compose up -d`. Флаг `-d` запускает контейнеры в фоновом режиме.

----
`Volumes` — это выделенные места на диске, которые существуют независимо от файловой системы образа контейнера. Даже если ты удалишь контейнер, данные в volume сохранятся. Это очень важно для сохранения данных, конфигураций, и результатов работы приложения.

volumes нужны для:
1. **Сохранение данных вне контейнера**. Если приложение сохраняет данные (логи, бд, файлы), то можно настроить сохранение данных вне контейнера. даже при удалении контейнера - эти данные сохранятся.
2. **Обмен данными между контейнерами**. Можно настроить volume, который будет доступен нескольким контейнерам. Помогает контейнерам обмениваться данными, не передавая данные по сети.
3. **Синхронизация с хост-машиной**. Настроить локальную папку, которая будет видна контейнеру и любые в ней изменения. Меняешь код - контейнер видит это.