Брокер сообщений позволяет элементам системы "общаться" друг с другом с помощью посредника, что снимает нагрузку с сервисов.

В брокере сообщений используется две сущности:
- Producer (издатель сообщений)
- Consumer (потребитель сообщений)

Producer → Очередь → Потребитель

Два варианта отправки сообщения:
1. Напрямую - каждое сообщение используется однократно
2. Схема подписки/публикации - сообщения отправляются в определённый топик и, все подписанные на топик забирают сообщения

**Брокеры нужны**:
- Для организации связи между службами
- Засчёт асинхронной обработки задач можно увеличить производительность системы в целом
- Обеспечение надёжности доставки сообщений

**Недостатки брокеров**:
- Усложнение системы, возникает зависимость от надёжности распределённой сети
- Могут возникать ошибки, которые вызывает асинхронность, и их сложно отследить
- Освоение подобных систем

**Польза брокера**:
- Если в рамках системы есть действия, которые требуют для своего выполнения много времени и потребляют много ресурсов, но не требуют мнгновенного результата.
- Микросервисы - для координации сложных систем, состоящих из микросервисов лучше использовать брокеры сообщений
- Пуш-уведомления
- Транзакционные системы с множеством этапов, которые выполняет отдельный элемент системы

----
##### Routing VS Pub/Sub VS Streaming

Pub/Sub:
- Издатель (Publisher) отправляет сообщение в **топик** (канал)
- Все подписчики (Subscribers) этого топика получают сообщение
- Пример:
	- Топик news/tech - подписчики получают все новости про технологии

Routing:
- Сообщения отправляются не всем, а выборочно, по определённым правилам.
- Типы маршрутизации в RabbitMQ:
	- Direct Exchange - сообщение идёт в очередь с точным совпадением ключа (routing_key)
	- Topic Exchange - можно использовать маски (`news.*`, `*.tech`)
	- Headers exchange - фильтрация по заголовкам (не по ключу)
- Пример:
	- В очередь `payments` попадают только сообщения с `routing_key=payment`.

Streams:
- Это лог сообщений, где хранятся данные и можно пересчитывать
- Особенности:
	- Сообщения имеют ID и сохраняются
	- Поддержка consumer groups
	- Можно читать с определённого места (XREAD)