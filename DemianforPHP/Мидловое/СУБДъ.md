СУБД - прослойка между БД и пользовательскими запросами.

Позволяет:
- Создавать БД и администрировать их: удалять, изменять, объединять.
- Держать данные в структурированном виде и необходимом формате.
- Защищать данные от нежелательных изменений и попыток взлома.
- Загружать и сортировать данные с помощью фильтров.
- Делать резервные копии, востанавливать БД после сбоев, поддерживать целостность.

СУБД - набор инструментов, который помогает совершать с БД определённные действия.

Главные элементы СУБД:
- Ядро
- Процессор
- Утилиты (Программные средства)
- БД

`Утилиты ⇄ Процессор ⇄ Ядро СУБД ⇄ БД`

**Ядро** - отвечает за работу всей системы в целом. Через него проходят все процессы обработки данных и их хранения. Ядро следит за всеми изменениями БД и фиксирует их.

**Процессор** (комплиятор) - занимается обработкой запросов от пользователей. Его задача: преобразовать SQL-запрос в понятные для компьютера команды, а также вернуть результат.

**Утилиты** - нужны, чтобы пользователь мог вводить запросы, а администраторы могли настраивать доступ и другие необходимые параметры.

БД - место, где данные хранятся в упорядоченном, а иногда и взашифрованном виде. БД могут различаться по структуре и типам представления данных.

#### Виды СУБД
СУБД делятся н а разные типы и по разным параметрам.

##### Для ЛЛ:
1. Реляционные - хороши почти для любых целей, где данные можно хранить в виде таблицы (для crud проектов) - PostgreSQL
2. Ключ-значение - хороши для логирования, кэширования, создание очередей - Redis
3. Документные - хороши для хранения данных в свободной форме в виде документов (json) - MongoDB
4. Графовые - хороши для хранение данных соц.сетей, безопасности - InfiniteGrapgh
5. Колоночные - хороши для всякой аналитики - ClickHouse

##### 1. По расположению БД

- **Локальные** - содержимое БД располагается на одном компьютере (обычно сервере компании)
- **Распределённые** - БД находится в облаке или на разных машинах

Современные СУБД могут быть одновременно и локальными и распределёнными.

##### 2. По хранению и обработке данных

- **Клиент-серверные** - СУБД с БД находятся на одной машине, к которой пользователи обращаются с запросами. Получить доступ к такой СУБД можно с любого компьютера.
  
  Популярный вариант для интернет-магазитов.
  
- **Файл-серверные** - БД находится на одном сервера, а СУБД находится на устройствах, с которых в БД отправляют запросы. Чтобы получить данные, у пользователя должна быть установлена и настроена СУБД.
  
  Популярный вариант для CRM-систем, где есть данные о клиентах и документооборот.
  
- **Встраиваемые** - локальные СУБД в виде отдельного модуля управления данными внутри приложений. Обычно написаны в виде библиотек для разных языков программирования.
  
  Например Microsoft Access и 1C Бухгалтерия.

##### 3. По языку запросов

- **SQL** - язык создания структурированных запросов. Самый популярный.
- **noSQL** - язык запросов к БД основан на другом языке программирования. noSQL СУБД обычно используют при работе с большими данными.

##### 4. По структуре и организации данных
- **Реляционные**
  Данные в виде таблицы, которые связаны друг с другом через сквозные параметры.  Обеспечивает построчное хранение данных и нужна для создания строгой структуры.
  
  При обращении к БД пользователь сможет получить лишь небольшое число элементов (часто это ограничивается драйвером или размером пакета)
  
  Каждая строка имеет уникальный идентификатор или ключ, что облегчает поиск и настраивание связей между таблицами.
  
  Реляционные БД используют чаще всего, когда объём данных не превышает нескольких терабайт.
  
  Популярные реляционные БД - PostgreSQL, Microsoft SQL Server, MySQL, Oracle.
  
  Важные характеристики реляционных БД:
    - Транзакционность - для выполнения одной операции нужно сделать несколько запросов к БД (например перевести деньги с одной карты на другую)
    - Частые изменения данных
    - Поиск по индексам - каждый элемент это строка, а искать по строке это удобно
    - Щапросы небольщого количества записей за раз
    - Объём данных не превышает терабайт

- **Ключ-значение**. 
  Каждый элемент БД использует для хранения уникальный идентификатор, который состоит из ключа и значения. Этот способ похож на тип данных "словарь" в языках программирования.
  
  БД типа "ключ-значение" имеют вид хэш-таблиц, в которой у каждой записи один индекс. При этом жёстких ограничений по структуре элементов нет.
  
  Такие БД используют по принципу логов, когда новые записи заносят в конец хранилища. Удаляют элементы с помощью добавления специальной записи.
  
  Способы использования БД типа "Ключ-значение" - очереди, кэш, логирование.
  
  Популярные БД типа "ключ-значение": Redis, DynamoDB, Aerospike.

Пример структуры данных:
  
```key-value
user:1 → {"name": "Alice", "age": 30, "city": "Moscow"}
user:2 → {"name": "Bob", "age": 25, "city": "Berlin"}
```

- **Документные**.
  Хранят инфморацию в виде "документов", а не строк и таблиц. Преимущество таких БД - возможность хранить информацию без строгого ограничения по структуре.
  
  Хранят информацию целиком и получают её одним запросом, даже если структура элементов будет разной.
  
  Документные базы позволяют использовать ссылки на другие записи в БД, что напоминает реляционные БД.
  
  Поплуярные "Документные" БД: MongoDB, CouchDB, Amazon DocumentDB.
  
  Пример хранение данных (обычно в json):
  
```json
  {
  "_id": "user1",
  "name": "Alice",
  "age": 30,
  "address": {
    "city": "Moscow",
    "street": "Lenina 1"
  },
  "hobbies": ["reading", "hiking"]
}
```

- **Графовые**.
  Элементы БД имеют взаимосвязи в виде графа, где у каждого узла есть множество связей с другими узлами, а также используют рёбра. В них хранятся начальный и конечный узлы, направления, тип.
  
  Рёбра описывают взаимосвязи между двумя узлами - родитель и потомок и действия над ними.
  
  Обойти весь граф можно довольно быстро, потому что связими между узлами не считаются во время запроса, а сразу хранятся в базе данных.
  
  Графовые БД применяются в соцсетях, рекомендательных сервисрах и системах выявления мощенниичества, когда нужно построить взаимосвязи между данными и запросить их.
  
  Поплуярные графовые БД: Amazon Neptune, Neo4j, InfiniteGrapgh.
  
  Пример структуры данных:
```graph
(Alice) -[:FRIENDS_WITH {since: 2020}]-> (Bob)
(Alice) -[:LIVES_IN]-> (Moscow)
(Bob) -[:FRIENDS_WITH]-> (Charlie)
(Charlie) -[:LIVES_IN]-> (Berlin)
```

- **Колоночные**.
  Данные хранятся последовательно в виде одной колонки и предполагается, что на одном и том же месте в каждой колонке хранятся элементы, которые относятся к одной строке.
  
  Такой подход позволят эффективно сжимать данные и анализировать их - находить сумму, количество или среднее значение.
  
  Колоночные данные можно представить в виде куба.
  ![[Pasted image 20250424125749.png]]
  Колоночные БД позволяют загружать новые данные непрерывным потоком или пропорциями. Но вот удалять их так нельзя.

  Применение таких БД - анализ данных. Такие БД используют чтобы хранить историю событий.

  Популярные колоночные БД: ClickHouse, Apache Druid, Vertica, BigQuery, TeraData.
  
  Пример хранения данных:
```bd
Колонка "user_id": [1, 2]
Колонка "name":    ["Alice", "Bob"]
Колонка "age":     [30, 25]
Колонка "city":    ["Moscow", "Berlin"]
Колонка "last_login": ["2023-10-01 12:00:00", "2023-10-02 15:30:00"]
```

Данные хранятся партиционно (шардирование) на разных нодах (серверах).

Пример кластера из 3х нод:
```bash
Нода 1 (192.168.1.10)  ←→  Нода 2 (192.168.1.11)  ←→  Нода 3 (192.168.1.12)
```

Зачем нужно шардирование по нодам?

- Масштабируемость - добавляя ноды, можно обработать больше данных и запросов
- Отказоустойчивость - если одна нода упала, остальные продолжают работать
- Локализация данных - данные можно размещать ближе к пользователям (ноды в определённых регионах)
- Репликация - можно реплицировать данные для увеличения отказоустойчивости

##### Проблемы распределения нод:
1. Согласованность данных - как гарантировать что все ноды видят актуальные данные (решается через протоколы типа Paxos, Raft)
2. Сетевые задержки - процесс запроса может замедлен из-за обмена между нодами
3. Мониторинг - усложняет управление кластером (нужны инструменты вроде Graphana, Prometheus)